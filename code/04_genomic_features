## genome size
#formula = assembly length / completeness fraction i.e. complete%/100 
## run micomplete #trained on reference marker genes
#full file paths to .fna genomes
find $(pwd)/genomes -name "*.fna" | awk '{print $0 "\tfna"}' > archaea_genomes.tab

#create new directory
mkdir micomplete_out

#run micomplete on default hmm set Arch131
miComplete "../archaea_genomes.tab" --hmms Arch131 --weights Arch131 --threads 5 > micomplete_results.tsv
#gives .tblout .progial.faa and results file

## Gene density
# formula = number of predicted protein-coding genes(CDS) / genome size
# calculated using micomplete output 

## GC content
#overall GC-content available as micomplete output

## @tRNAs (tRNAscan-SE) 

mkdir trnascan_out
 
for file in ../ncbi_dataset/data/*/*fna; do 
  base=$(basename "$file" _genomic.fna); 
  acc=$(echo "$base" | cut -d'.' -f1-2 | cut -d'.' -f1); 
  tRNAscan-SE -A -a "${acc}_trna.fna" -o "${acc}_trna.txt" "$file"; 
done

### @3rd silent codon position (codonw) 

#prokka tends to output incomplete .ffn files, which do not work for codonw
#use prodigal and filter for complete sequences

#run prodigal
for file in ../ncbi_dataset/data/*/*fna; do
  base=$(basename "$file" _genomic.fna);
  acc=$(echo "$base" | cut -d'.' -f1-2 | cut -d'.' -f1);
  prodigal -i "$file" -a "${acc}.faa" -d "${acc}_cds.ffn" -g 11 -c -m -f gff -o "${acc}_prodigal.gff"; #code 11 is bacterial/archaeal code
done


#install codonw
conda install -c bioconda codonw

#create directory
mkdir gc3_results

#run codonw
for file in ../prodigal_out/*ffn; do 
  base=$(basename "$file" .ffn)
  codonw "$file" -all_indices -nomenu
  mv "${base}.blk" "gc3_results/${base}_gc3.blk"; 
done

